function isPrintableKey(e){var t=e.keyCode,s=t>47&&58>t||32==t||t>64&&91>t||t>95&&112>t||t>185&&193>t||t>218&&223>t;return s}function isNonPrintableKey(e){return!isPrintableKey(e)}function isCombinationKeyPressed(e){return e.ctrlKey||e.altKey||e.shiftKey||e.metaKey}function selectItemByValue(e,t){for(var s=0;s<e.options.length;s++)if(e.options[s].value===t){e.selectedIndex=s;break}}function getMaxLengthMessage(){switch(getStore()){case store.Ca_fr:case store.Fr:return" caractères restants ("+Max_Length+" maximum)";case store.De:return" characters remaining ("+Max_Length+" maximum)";case store.Es:return" characters remaining ("+Max_Length+" maximum)";case store.It:return" characters remaining ("+Max_Length+" maximum)";case store.Pt:return" characters remaining ("+Max_Length+" maximum)";case store.Au:return" characters remaining ("+Max_Length+" maximum)";case store.Nz:return" characters remaining ("+Max_Length+" maximum)";case store.Uk:return" characters remaining ("+Max_Length+" maximum)";case store.Ca_en:case store.Us:default:return" characters remaining ("+Max_Length+" maximum)"}}function getMaxLengthReachMessage(){switch(getStore()){case store.Ca_fr:case store.Fr:return"la longueur maximum de <b>"+Max_Length+"</b> caractères est atteint";case store.De:return"the max length of <b>"+Max_Length+"</b> characters is reached";case store.Es:return"the max length of <b>"+Max_Length+"</b> characters is reached";case store.It:return"the max length of <b>"+Max_Length+"</b> characters is reached";case store.Pt:return"the max length of <b>"+Max_Length+"</b> characters is reached";case store.Au:return"the max length of <b>"+Max_Length+"</b> characters is reached";case store.Nz:return"the max length of <b>"+Max_Length+"</b> characters is reached";case store.Uk:return"the max length of <b>"+Max_Length+"</b> characters is reached";case store.Ca_en:case store.Us:default:return"the max length of <b>"+Max_Length+"</b> characters is reached"}}function validateMaxLength(e){var t,s=document.getElementById("checkout_shipping_address_address1").value;t=e&&("keypress"==e.type||"keydown"==e.type)?"8"==e.keyCode?0==s.length?s.length:s.length-1:isNonPrintableKey(e)||isCombinationKeyPressed(e)?s.length:s.length+1:s.length;var r=document.getElementById("maxLength");if(t>Max_Length)address1=document.getElementById("checkout_shipping_address_address1"),address1.parentNode.className="field field--required field--error field--focus",r.innerHTML=getMaxLengthReachMessage();else{address1=document.getElementById("checkout_shipping_address_address1"),address1.parentNode.className="field field--required";var a=Max_Length-t;r.innerHTML=a+getMaxLengthMessage()}}function fillInAddress(){var e=autocomplete.getPlace();for(var t in componentForm)document.getElementById(componentForm[t]).value="",document.getElementById(componentForm[t]).disabled=!1;for(var s,r,a,n,o="",i=0;i<e.address_components.length;i++){var d=e.address_components[i].types[0];if(componentFormMapping[d]){var c=e.address_components[i][componentFormMapping[d]];"street_number"==d&&(o+=c),"route"==d&&(o+=""!=o?" "+c:c),"locality"==d?a=c:"postal_code"==d?n=c:"country"==d?s=c:r=c}}o&&(document.getElementById("checkout_shipping_address_address1").value=o),a&&(document.getElementById("checkout_shipping_address_city").value=a),n&&(document.getElementById("checkout_shipping_address_zip").value=n),r&&("Québec"==r&&(r="Quebec"),selectItemByValue(document.getElementById("checkout_shipping_address_province"),r)),validateMaxLength(),document.activeElement.blur()}if(window.store={Ca_en:/ca.kobo/i,Ca_fr:/ca-fr.kobo/i,Us:/us.kobo/i,De:/de.kobo/i,Es:/es.kobo/i,It:/it.kobo/i,Pt:/pt.kobo/i,Fr:/fr.kobo/i,Au:/au.kobo/i,Nz:/nz.kobo/i,Uk:/uk.kobo/i},window.getStore=function(){var e=window.location.href;return store.Ca_en.test(e)?store.Ca_en:store.Ca_fr.test(e)?store.Ca_fr:store.Us.test(e)?store.Us:store.De.test(e)?store.De:store.Es.test(e)?store.Es:store.It.test(e)?store.It:store.Pt.test(e)?store.Pt:store.Fr.test(e)?store.Fr:store.Au.test(e)?store.Au:store.Nz.test(e)?store.Nz:store.Uk.test(e)?store.Uk:void 0},window.getCountryCode=function(){switch(getStore()){case store.Us:return"US";case store.De:return"DE";case store.Es:return"ES";case store.It:return"IT";case store.Pt:return"PT";case store.Fr:return"FR";case store.Au:return"AU";case store.Nz:return"NL";case store.Uk:return"GB";case store.Ca_en:case store.Ca_fr:default:return"CA"}},window.getCountryLanguageCode=function(){switch(getStore()){case store.Ca_fr:case store.Fr:return"fr";case store.De:return"de";case store.Es:return"es";case store.It:return"it";case store.Pt:return"pt-PT";case store.Au:return"en-AU";case store.Nz:return"nl";case store.Uk:return"en-GB";case store.Ca_en:case store.Us:default:return"en"}},getStore()==store.Us){var text=document.getElementById("checkout_shipping_address_address1");text.parentNode.innerHTML+='<p id="message" class="field__error-message warning"></p>';var message=document.getElementById("message");message.innerHTML="Kobo does not ship to PO Boxes and will require a street address for delivery";var text=document.getElementById("checkout_shipping_address_address1"),poBoxText="PO BOX;POBOX;P O BOX;P OBOX;P.O.BOX;P.O BOX;P.OBOX;P.O. BOX;P. O. BOX;PO.BOX;P O.BOX;P O. BOX;PO. BOX".split(";"),show=!1,showText=!1;"field field--required field--error"==text.parentNode.className&&(show=!0),message.style.display=1==showText?"display":"none"}var Max_Length=35,fields="checkout_shipping_address_first_name checkout_shipping_address_last_name checkout_shipping_address_address1 checkout_shipping_address_address2 checkout_shipping_address_city checkout_shipping_address_zip checkout_shipping_address_phone checkout_billing_address_first_name checkout_billing_address_last_name checkout_billing_address_address1 checkout_billing_address_address2 checkout_billing_address_city checkout_billing_address_zip checkout_billing_address_phone".split(" ");for(i=0;i<fields.length;i++)document.getElementById(fields[i]).maxLength=Max_Length;var componentForm=["checkout_shipping_address_city","checkout_shipping_address_zip","checkout_shipping_address_province"],placeSearch,autocomplete,componentFormMapping={street_number:"short_name",route:"long_name",locality:"long_name",administrative_area_level_1:"long_name",country:"long_name",postal_code:"short_name"},address1=document.getElementById("checkout_shipping_address_address1");address1.parentNode.innerHTML=address1.parentNode.innerHTML+'<p id="maxLength" class="field__error-message warning"></p>';var maxLength=document.getElementById("maxLength");address1=document.getElementById("checkout_shipping_address_address1"),address1.maxLength=Max_Length,maxLength.style.display="block";var currentLeftLength=Max_Length;maxLength.innerHTML=currentLeftLength+getMaxLengthMessage(),address1.onkeydown=validateMaxLength,address1.onblur=validateMaxLength;var select=document.getElementById("checkout_shipping_address_country"),country=select.options[select.selectedIndex].value;if("United States"==country){var text=document.getElementById("checkout_shipping_address_address1"),message=document.getElementById("message");for(text.onkeyup=function(e){for(showText=!1,i=0;i<poBoxText.length;i++)if(-1!=text.value.toLowerCase().indexOf(poBoxText[i].toLowerCase())){showText=!0;break}1==showText?(text.parentNode.className="field field--required field--error field--focus",message.style.display="block"):(text.parentNode.className=show?"field field--required field--error field--focus":"field field--required field--focus",message.style.display="none")},i=0;i<poBoxText.length;i++)if(-1!=text.value.toLowerCase().indexOf(poBoxText[i].toLowerCase())){showText=!0;break}}window.initAutocomplete=function(){var e={types:["address"],componentRestrictions:{country:getCountryCode()}};""==e.componentRestrictions.country&&delete e.componentRestrictions;var t=document.getElementById("checkout_shipping_address_address1");google.maps.event.addDomListener(t,"keydown",function(e){13==e.keyCode&&e.preventDefault()}),autocomplete=new google.maps.places.Autocomplete(document.getElementById("checkout_shipping_address_address1"),e),autocomplete.addListener("place_changed",fillInAddress)};var googleMapEventListenerScript=document.createElement("script");googleMapEventListenerScript.async=!0,googleMapEventListenerScript.src="https://maps.googleapis.com/maps/api/js?key=AIzaSyAwO_kj1b7YdHj_Gp567LepbrRGW4s-n4s&signed_in=true&libraries=places&callback=initAutocomplete&language="+getCountryLanguageCode(),document.getElementsByTagName("head")[0].appendChild(googleMapEventListenerScript);